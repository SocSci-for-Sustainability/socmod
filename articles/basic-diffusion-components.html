<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Components for basic diffusion modeling with socmod • socmod</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="basic-diffusion-components_files/libs/quarto-html/popper.min.js"></script><script src="basic-diffusion-components_files/libs/quarto-html/tippy.umd.min.js"></script><link href="basic-diffusion-components_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="basic-diffusion-components_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Components for basic diffusion modeling with socmod">
<meta property="og:image" content="https://css4s.github.io/socmod/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">socmod</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic-diffusion-components.html">Components for basic diffusion modeling with socmod</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Components for basic diffusion modeling with socmod</h1>

      <p class="author">Matt Turner</p>



      <div class="d-none name"><code></code></div>
    </div>






    <p>This vignette introduces agent-based modeling in <code>socmod</code> starting with basic functional and object-oriented programming in R. It therefore builds on an assumed knowledge of R basics which can be gained by studying, for example, <a href="https://rstudio-education.github.io/hopr/index.html" class="external-link"><em>Hands-On Programming with R</em></a> or other basic R tutorial introductions.</p>
<p>To model social behavior it helps to have intuitive software tools grounded in an empirically-motivated, self-consistent scientific theory. <code>socmod</code> provides those tools, but to put it to best use it’s helpful to know how it works, especially for people used to using R in a data science context. Many of the same tools are transferable, especially declarative/functional programming, as is used and encouraged by the <a href="https://r4ds.hadley.nz/" class="external-link">tidy approach in R for Data Science</a>.</p>
<p>To create simulations that <em>generate</em> social behavior we have to go beyond tabular representations of the world to more complex representations of people and their interactions that can be measured. These measurements are recorded in a standard tabular format, e.g., CSV, which can then be analyzed using tidy/R for Data Science strategies.</p>
<p>In agent-based modeling, we create software representations of simulated people, i.e. <em>agents</em>, or other interacting entities, including the agents’ environment. <em>Object-oriented programming</em> is the natural choice for software design in this case because it provides a structure for defining custom <em>objects</em> like socially interacting agents. An <em>object</em> is one bit of data that could be a number or character type, but could also be something more complicated. In object-oriented programming we define custom <em>classes</em> that specify various data <em>fields</em> and function <em>methods</em> for maintaining and modifying the state of objects. The fields and methods of a class therefore are sets of related data and functions to represent things in the world.</p>
<p>To summarize, objects are a way to track and modify the state of different software entities. We can create simulations of real-world systems by defining custom object types called classes whose state and behaviors are modeled on relevant real-world features and behaviors.</p>
<p>In <code>socmod</code>, we define custom R objects for agent-based models of social behavior using the <code>R6Class</code> method that creates a new object type, i.e., a new <em>class</em>. We use tidy-style functional programming where helpful to represent model features and dynamics.</p>
<p>In the remainder of this vignette, I will first review variable assignment and data structures in R including vectors, lists, data.frames, and tibbles. We then review relevant topics in functional programming, then demonstrate how to create custom classes in R with the library <a href="https://r6.r-lib.org/" class="external-link">R6</a>. This tutorial then closes with a demonstration of a simple four-agent agent-based model of social behavior, kept simple to highlight the functional and object-oriented design patterns in <code>socmod</code>, representing <code>Agent</code>, an <code>AgentBasedModel</code>, and <code>Trial</code>classes defined using the <a href="https://r6.r-lib.org/reference/is.R6.html?q=r6class#ref-usage" class="external-link"><code>R6Class</code> function</a>.</p>
<section class="level2"><h2 id="data-collection-types-in-r">Data collection types in R<a class="anchor" aria-label="anchor" href="#data-collection-types-in-r"></a>
</h2>
<p>In R, there is a hierarchy of data collection types that are necessary to know about for functional programming, which often involves applying a function across every element of a collection of data. Data collections include vectors, lists, data.frames, and tibbles, which we’ll cover here.</p>
<section class="level3"><h3 id="collections-of-basic-data-types">Collections of basic data types<a class="anchor" aria-label="anchor" href="#collections-of-basic-data-types"></a>
</h3>
<p>In computer science, a <em>collection</em> is an abstract data type that organizes and stores instances of other data types. In R, the most basic data types are numbers (e.g., <code>double</code> or <code>integer</code>) and text, whose data type is <code>character</code> in R whether it’s a single character or several:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/typeof.html" class="external-link">typeof</a></span><span class="op">(</span><span class="st">'c'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/typeof.html" class="external-link">typeof</a></span><span class="op">(</span><span class="st">"social science is kewl"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
</section><section class="level3"><h3 id="vectors">Vectors<a class="anchor" aria-label="anchor" href="#vectors"></a>
</h3>
<p>R vectors are defined using the <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> function, e.g., <code>vec &lt;- c(0, 0, 1)</code>. The data type of all vector elements must be the same. This is enforced by R coercing data to different types, for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="st">"yo"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "0"  "0"  "yo"</code></pre>
</div>
</div>
<p>We index vectors using single square brackets, with R indexing starting from 1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span> <span class="co"># equiv to vec &lt;- 1:5 or seq(1, 5)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">vec</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vec</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
</section><section class="level3"><h3 id="lists">Lists<a class="anchor" aria-label="anchor" href="#lists"></a>
</h3>
<p>If one wants to keep elements of different types in a single collection, use the R <code>list</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">542</span>, <span class="st">"yo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0

[[2]]
[1] 542

[[3]]
[1] "yo"</code></pre>
</div>
</div>
<p>Note the visual representation has changed on printout. We now need to use double-square brackets to index list elements themselves:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">l</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "yo"</code></pre>
</div>
</div>
<p>If we leave off one of the square brackets we effectively get a sub-list with just one element:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">l</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "yo"</code></pre>
</div>
</div>
<p>This is useful if you want to create a new sub-list with more than one element:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">l</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 542

[[2]]
[1] "yo"</code></pre>
</div>
</div>
</section><section class="level3"><h3 id="named-lists">Named lists<a class="anchor" aria-label="anchor" href="#named-lists"></a>
</h3>
<p>Named lists are the primary key-value store in R, just like <code>dict</code> in Python. It allows us to label entries of the list and access them using double square brackets with the character name or using the <code>$</code> access operator:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">named_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">named_l</span><span class="op">$</span><span class="va">a</span> <span class="op">==</span> <span class="va">named_l</span><span class="op">[[</span><span class="st">"a"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># compares element-by-element</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">named_l</span><span class="op">$</span><span class="va">b</span> <span class="op">==</span> <span class="va">named_l</span><span class="op">[[</span><span class="st">"b"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section><section class="level3"><h3 id="tibble-and-data-frame">
<code>tibble</code> (and <code>data.frame</code>)<a class="anchor" aria-label="anchor" href="#tibble-and-data-frame"></a>
</h3>
<p>Both the <code>tibble</code> and <code>data.frame</code> classes represent tabular data, meaning data that can be represented in table format, e.g., in comma- or tab-separated value format. There are some subtle differences listed below, but we’ll use <code>tibble</code> for representing our tables.</p>
<p>Tibbles are like fancy lists that have special properties that make data manipulation more efficient. The details of how this works aren’t super important at this point. The important thing to know is how one can initialize tibbles and access tibble columns similarly to lists, as shown in the following example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">$</span><span class="va">a</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 5 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">[[</span><span class="st">"b"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7 8 9</code></pre>
</div>
</div>
<p>Using tibbles ensures that data manipulation and analysis using the tidyverse will work as expected. For example, the tidyverse provides functions for analyzing different groups of data within a larger dataset. This is a common data analysis pattern called split-apply-combine, which in the tidyverse translates to group-by and summarise when using the <code>dplyr</code> library. For example, we can calculate the mean of measurements in “experimental” and “control” conditions in some fake data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observations</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"experimental"</span>, <span class="st">"experimental"</span>, <span class="st">"control"</span>, <span class="st">"control"</span><span class="op">)</span>,</span>
<span>  measurement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13.5</span>, <span class="fl">14.6</span>, <span class="fl">3.4</span>, <span class="fl">5.4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mean_measurement_tbl</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">observations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">condition</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_measurement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">measurement</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mean_measurement_tbl</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  condition    mean_measurement
  &lt;chr&gt;                   &lt;dbl&gt;
1 control                   4.4
2 experimental             14.0</code></pre>
</div>
</div>
</section><section class="level3"><h3 id="difference-between-data-frame-and-tibble">Difference between <code>data.frame</code> and <code>tibble</code>
<a class="anchor" aria-label="anchor" href="#difference-between-data-frame-and-tibble"></a>
</h3>
<p>The <code>tibble</code> library provides a table data representation (also called <code>tibble</code>) that is a bit more flexible and intuitive than the R built-in <code>data.frame</code>. One reason I prefer tibbles is because traditional data.frames automatically convert strings to factors unless you tell them not to. Tibbles don’t, so you’re never surprised.</p>
<p>Column naming is also more flexible with tibbles. A data.frame requires syntactically valid R names, while tibbles can handle column names that include spaces or even non-standard characters. I often use this feature to use column names like <code>Mean adaptation success</code> that print nicely when used as labels in <code>ggplot</code>.</p>
<p>Finally, tibble operations always return a tibble. For example, if <code>df</code> were a data.frame, the operation <code>df[, 1]</code> would return a vector by default. If it were a tibble it would return another tibble, making behavior more predictable in data analysis pipelines.</p>
</section></section><section class="level2"><h2 id="functional-programming">Functional programming<a class="anchor" aria-label="anchor" href="#functional-programming"></a>
</h2>
<p>Functional programming is especially useful for writing code that applies the same function to several inputs, but wants to leave it up to the user to specify exactly which function should be applied. In <code>socmod</code> we pass functions as arguments to other functions to specify how agents pick their interaction partners (i.e., teachers in a learning context) and how social learning works. Here are some simple examples demonstrating the key concepts and techniques of functional programming that could help with <code>socmod</code> programming.</p>
<section class="level3"><h3 id="higher-order-functions-functions-with-function-arguments">Higher-order functions: functions with function arguments<a class="anchor" aria-label="anchor" href="#higher-order-functions-functions-with-function-arguments"></a>
</h3>
<p>In R, and other programming languages supporting the functional style, one can treat functions like any other data and pass it as an argument to other functions. A function that accepts a function as an argument is called a <em>higher-order function</em>. Here is a simple example of a higher order function that takes some <code>data</code> as a first argument and applies the function <code>f</code> to that data twice, putting the result of each calculation in a two-element vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">repeat_2_higher_order_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">f</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="fu">f</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p>Below we call this higher order function by providing <code>data=2</code> as the first argument and an <em>anonymous function</em> as the second argument, which can be written using <code>\(arg) { ...function body... }</code> syntax:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># \(x) {...} is equivalent to function(x) { ... }; these are </span></span>
<span><span class="co"># anonymous functions.</span></span>
<span><span class="co"># Expecting to return c(4, 4)</span></span>
<span><span class="fu">repeat_2_higher_order_func</span><span class="op">(</span>data <span class="op">=</span> <span class="fl">2</span>, f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span> </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4 4</code></pre>
</div>
</div>
<p>The above is the representation of a vector printed to screen, so we see that our expectations were matched.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4 4</code></pre>
</div>
</div>
</section><section class="level3"><h3 id="map-a-common-useful-higher-order-function-used-often-in-socmod">
<code>map</code>: a common, useful higher-order function used often in <code>socmod</code>
<a class="anchor" aria-label="anchor" href="#map-a-common-useful-higher-order-function-used-often-in-socmod"></a>
</h3>
<p>One of the most useful and common higher-order functions is the map function. This function <em>maps</em> a function, denoted <code>.f</code> below, onto every element in a collection, denoted <code>.x</code>. This notation is from the <code>map</code> family of functions in the <a href="https://purrr.tidyverse.org/" class="external-link"><code>purrr</code> library</a> for tidy functional programming.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<p>Here is an example of mapping an anonymous function that multiplies its input by 3 onto a vector with entries 2 and 8:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now get we use map_vec that applies .f to every element of .x,</span></span>
<span><span class="co"># expecting the following to return a vector with elements 3*2 </span></span>
<span><span class="co"># and 3*8, i.e., c(6, 24).</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_vec</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">8</span><span class="op">)</span>, .f <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  6 24</code></pre>
</div>
</div>
<p>If we want to apply a function that takes two variables, the value and index of an element in a collection, we can use the <code>imap</code> family of functions as follows to return a vector that contains the original element multiplied by its place in the input vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5050</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">imap_vec</a></span><span class="op">(</span><span class="va">input_vec</span>, \<span class="op">(</span><span class="va">el</span>, <span class="va">idx</span><span class="op">)</span> <span class="op">{</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">idx</span> <span class="op">*</span> <span class="va">el</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]     2 10100    18</code></pre>
</div>
</div>
</section></section><section class="level2"><h2 id="custom-objects-r6-classes-in-socmod">Custom objects: R6 classes in socmod<a class="anchor" aria-label="anchor" href="#custom-objects-r6-classes-in-socmod"></a>
</h2>
<p>Classes are ways to <em>encapsulate</em> diverse distinct, but related, processes, behaviors, data, attributes, and other types of information in a single <em>object</em>, i.e., a software representation of an <em>instance</em> of that entity. R6 is a library for creating our own custom classes that serve as an abstract template that specifies what distinguishes different types of objects/entities. Below we show first how to create a new agent, i.e., a new instance of the <code>Agent</code> class that is provided by <code>socmod</code>. After that is a fun example of how we can design a different social behavioral model, one of football/soccer matches. We write classes for players and teams and develop a <code>play_match(team1, team2)</code> function that pits two teams against each other.</p>
<section class="level3"><h3 id="the-agent-class-in-socmod">The <code>Agent</code> class in <code>socmod</code>
<a class="anchor" aria-label="anchor" href="#the-agent-class-in-socmod"></a>
</h3>
<p>Below we create a new instance of the <code>Agent</code> class using the class <em>constructor</em>, the function written <code>socmod::Agent$new()</code> below that creates a new instance of the class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/Agent.html">Agent</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span>, name <span class="op">=</span> <span class="st">"Matt"</span>, </span>
<span>                        behavior <span class="op">=</span> <span class="st">"Adaptive"</span>, </span>
<span>                        fitness<span class="op">=</span><span class="fl">1e6</span><span class="op">)</span></span></code></pre></div>
</div>
<p>We can use the <em>access operator</em>, <code>$</code> in R, to access the <em>fields</em> (i.e., <em>attributes</em>) of agent <code>a1</code> like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">a1</span><span class="op">$</span><span class="fu">get_fitness</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1e+06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">a1</span><span class="op">$</span><span class="fu">get_name</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Matt"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">a1</span><span class="op">$</span><span class="fu">get_id</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">a1</span><span class="op">$</span><span class="fu">get_behavior</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Adaptive"</code></pre>
</div>
</div>
<p>We can also use <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map</a></code> functions over neighbors like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign neighbors to a1.</span></span>
<span></span>
<span><span class="va">a1</span><span class="op">$</span><span class="fu">set_neighbors</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/Agent.html">Agent</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">2</span>, name <span class="op">=</span> <span class="st">"n2"</span><span class="op">)</span>,</span>
<span>  <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/Agent.html">Agent</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>id <span class="op">=</span> <span class="fl">3</span>, name <span class="op">=</span> <span class="st">"n3"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the list of neighbors back to check it worked.</span></span>
<span><span class="va">neighbors</span> <span class="op">&lt;-</span> <span class="va">a1</span><span class="op">$</span><span class="fu">get_neighbors</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">neighbors</span><span class="op">)</span><span class="op">)</span>  <span class="co"># should be [1] "Neighbors" "R6"</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Neighbors" "R6"       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Neighbors$map() returns a list...</span></span>
<span><span class="va">neighbor_names</span> <span class="op">&lt;-</span> <span class="va">neighbors</span><span class="op">$</span><span class="fu">map</span><span class="op">(</span>\<span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="va">n</span><span class="op">$</span><span class="fu">get_name</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">neighbor_names</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "n2"

[[2]]
[1] "n3"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ...use `unlist` to convert it to a vector:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">neighbor_names</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "n2" "n3"</code></pre>
</div>
</div>
</section><section class="level3"><h3 id="exercise-design-and-define-classes-from-scratch">Exercise: design and define classes from scratch<a class="anchor" aria-label="anchor" href="#exercise-design-and-define-classes-from-scratch"></a>
</h3>
<p>In class we started creating our model of a soccer player agent called <code>Footballer</code>, defined below. We ran out of time at the end of class to write <em>methods</em> for <code>Footballer</code>, i.e., ways that a football player could interact with the world, or that the world could act upon a soccer player. However we only had time to create a <em>stub</em> for two methods. A stub is a minimal chunk of code that does very little to nothing, but doesn’t get in the way by causing errors or anything like that. It enables us to document our plans for future development in the exact place where it would happen in the code.</p>
<p>Below we have stubs for <code>score_goal</code> and <code>get_penalty</code> methods for in-game behaviors. Other possibilities could include <code>get_traded</code> that would change its team and perhaps <code>get_signed</code> for cases where a player is a free agent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r6.r-lib.org" class="external-link">R6</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">Footballer</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6Class</a></span><span class="op">(</span><span class="st">"Footballer"</span>,</span>
<span>                        </span>
<span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Listing attributes as fields and </span></span>
<span>    <span class="co"># setting to zero for their definition.</span></span>
<span>    speed <span class="op">=</span> <span class="fl">0.0</span>,  <span class="co"># units of max km/h</span></span>
<span>    accuracy <span class="op">=</span> <span class="fl">0.0</span>, <span class="co"># probability of scoring on a shot</span></span>
<span>    market_value <span class="op">=</span> <span class="fl">0.0</span>, <span class="co"># </span></span>
<span>    aggressiveness <span class="op">=</span> <span class="fl">0.0</span>, <span class="co"># units of penalties per match</span></span>
<span>    team <span class="op">=</span> <span class="st">""</span>,</span>
<span>    </span>
<span>    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">speed</span> <span class="op">=</span> <span class="fl">15</span>, </span>
<span>                          <span class="va">accuracy</span> <span class="op">=</span> <span class="fl">0.2</span>, <span class="va">market_value</span> <span class="op">=</span> <span class="fl">1e6</span>, </span>
<span>                          <span class="va">aggressiveness</span> <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                          <span class="va">team</span> <span class="op">=</span> <span class="st">"Free agent"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">speed</span> <span class="op">=</span> <span class="va">speed</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">accuracy</span> <span class="op">=</span> <span class="va">accuracy</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">market_value</span> <span class="op">=</span> <span class="va">market_value</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">aggressiveness</span> <span class="op">=</span> <span class="va">aggressiveness</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">team</span> <span class="op">=</span> <span class="va">team</span></span>
<span>    <span class="op">}</span>,</span>
<span>    </span>
<span>    <span class="co"># Stub two SoccerPlayer class methods...</span></span>
<span>    <span class="co"># ...one for scoring a goal in a game...</span></span>
<span>    scored_goal <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">self</span><span class="op">$</span><span class="va">accuracy</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    <span class="co"># ...and one for getting a penalty in a game.</span></span>
<span>    get_penalty_on_play <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">self</span><span class="op">$</span><span class="va">aggressiveness</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">Team</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6Class</a></span><span class="op">(</span><span class="st">"Team"</span>,</span>
<span>                </span>
<span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">""</span>,</span>
<span>    players <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    wins <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    ties <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    payroll <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    games_played <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    </span>
<span>    <span class="co"># Team name is required, with players optionally specified.</span></span>
<span>    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">name</span>, <span class="va">players</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">name</span> <span class="op">=</span> <span class="va">name</span></span>
<span></span>
<span>      <span class="co"># Initialize players and payroll.</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">player</span> <span class="kw">in</span> <span class="va">players</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">self</span><span class="op">$</span><span class="va">payroll</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">payroll</span> <span class="op">+</span> <span class="va">player</span><span class="op">$</span><span class="va">market_value</span></span>
<span>        <span class="va">player</span><span class="op">$</span><span class="va">team</span> <span class="op">&lt;-</span> <span class="va">name</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">players</span> <span class="op">&lt;-</span> <span class="va">players</span></span>
<span>    <span class="op">}</span>,</span>
<span>    </span>
<span>    <span class="co"># Add a player to the roster.</span></span>
<span>    sign_player <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">player</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Add the player to the team.</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">players</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">players</span>, <span class="va">player</span><span class="op">)</span></span>
<span>      <span class="co"># Update payroll.</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="va">payroll</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">payroll</span> <span class="op">+</span> <span class="va">player</span><span class="op">$</span><span class="va">market_value</span></span>
<span>      <span class="co"># Update the player's team to be this team's name.</span></span>
<span>      <span class="va">player</span><span class="op">$</span><span class="va">team</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">name</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">footballer</span> <span class="op">&lt;-</span> <span class="va">Footballer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">footballer</span><span class="op">$</span><span class="fu">scored_goal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sum(purrr::map_vec(1:10, \(.) p$scored_goal()))</span></span></code></pre></div>
</div>
<p>We can define a function that simulates playing a football match where the team that scores more goals wins, or a tie if teams have the same score. We track penalties received but assume they don’t have an effect on the match outcome. We assume each player gets ten chances to score a goal. We leave it to the reader as an exercise to make use of the <code>Footballer$get_penalty_on_play()</code> method within the game to add penalties and consequences in the game (e.g., penalty kicks or something), and to use the <code>Team$sign_player()</code> add more players to each roster, which should increase the mean total scores in each game based on the simple way we’ve modeled gameplay in <code>play_match</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a function that models a football match.</span></span>
<span><span class="va">play_match</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">team1</span>, <span class="va">team2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Walk over each player to see how many scores they get, </span></span>
<span>  <span class="co"># summing to get the total team score. </span></span>
<span>  <span class="va">team1_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_vec</a></span><span class="op">(</span></span>
<span>      <span class="va">team1</span><span class="op">$</span><span class="va">players</span>,</span>
<span>      \<span class="op">(</span><span class="va">player</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Calculate the total goals scored by the current player.</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_vec</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, \<span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="va">player</span><span class="op">$</span><span class="fu">scored_goal</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span> </span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">team2_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_vec</a></span><span class="op">(</span></span>
<span>      <span class="va">team2</span><span class="op">$</span><span class="va">players</span>,</span>
<span>      \<span class="op">(</span><span class="va">player</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Calculate the total goals scored by the current player.</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_vec</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, \<span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="va">player</span><span class="op">$</span><span class="fu">scored_goal</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span> </span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">team1_score</span> <span class="op">==</span> <span class="va">team2_score</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">team1</span><span class="op">$</span><span class="va">ties</span> <span class="op">&lt;-</span> <span class="va">team1</span><span class="op">$</span><span class="va">ties</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="va">team2</span><span class="op">$</span><span class="va">ties</span> <span class="op">&lt;-</span> <span class="va">team2</span><span class="op">$</span><span class="va">ties</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Tie game!\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">team1_score</span> <span class="op">&gt;</span> <span class="va">team2_score</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">team1</span><span class="op">$</span><span class="va">name</span>, <span class="st">"wins!!!\n"</span><span class="op">)</span></span>
<span>    <span class="va">team1</span><span class="op">$</span><span class="va">wins</span> <span class="op">&lt;-</span> <span class="va">team1</span><span class="op">$</span><span class="va">wins</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">team2</span><span class="op">$</span><span class="va">name</span>, <span class="st">"wins!!!\n"</span><span class="op">)</span></span>
<span>    <span class="va">team2</span><span class="op">$</span><span class="va">wins</span> <span class="op">&lt;-</span> <span class="va">team2</span><span class="op">$</span><span class="va">wins</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">team1</span><span class="op">$</span><span class="va">name</span>, <span class="st">": "</span>, <span class="va">team1_score</span>, <span class="st">"   "</span>,  </span>
<span>      <span class="va">team2</span><span class="op">$</span><span class="va">name</span>, <span class="st">": "</span>, <span class="va">team2_score</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">team1</span><span class="op">$</span><span class="va">games_played</span> <span class="op">&lt;-</span> <span class="va">team1</span><span class="op">$</span><span class="va">games_played</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">team2</span><span class="op">$</span><span class="va">games_played</span> <span class="op">&lt;-</span> <span class="va">team2</span><span class="op">$</span><span class="va">games_played</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<p>First we need teams, which we create and to which we assign players using the constructor, <code>Team$new()</code> in the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize two teams, Whales and Squirrels, each with two</span></span>
<span><span class="co"># players. All players have identical default attributes.</span></span>
<span><span class="va">whales</span> <span class="op">&lt;-</span> <span class="va">Team</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Whales"</span>, </span>
<span>  players <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Footballer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>, <span class="va">Footballer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">squirrels</span> <span class="op">&lt;-</span> <span class="va">Team</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Squirrels"</span>, </span>
<span>  players <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Footballer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>, <span class="va">Footballer</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Play three matches.</span></span>
<span><span class="fu">play_match</span><span class="op">(</span><span class="va">whales</span>, <span class="va">squirrels</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Squirrels wins!!!
Whales :  2     Squirrels :  5 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">play_match</span><span class="op">(</span><span class="va">squirrels</span>, <span class="va">whales</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tie game!
Squirrels :  5     Whales :  5 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">play_match</span><span class="op">(</span><span class="va">squirrels</span>, <span class="va">whales</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Whales wins!!!
Squirrels :  5     Whales :  6 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print how many games each time won.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAfter three games..."</span>, <span class="st">"\nThe Whales have won"</span>, </span>
<span>    <span class="va">whales</span><span class="op">$</span><span class="va">wins</span>, <span class="st">"games and the Squirrels have won"</span>, <span class="va">squirrels</span><span class="op">$</span><span class="va">wins</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
After three games...
The Whales have won 1 games and the Squirrels have won 1</code></pre>
</div>
</div>
</section></section><section class="level2"><h2 id="agent-based-models-of-social-behavior">Agent-based models of social behavior<a class="anchor" aria-label="anchor" href="#agent-based-models-of-social-behavior"></a>
</h2>
<p>Here we develop our first agent-based models of social behavior. We’ll start small, with the following four-household network of solar panel electrification using only success-biased learning (<a href="#fig-four-agent-example" class="quarto-xref">Figure 1</a>). Then we’ll do a detailed comparison of different social learning strategies with different parameterizations.</p>
<div id="fig-four-agent-example" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-four-agent-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="four-agent-example.png" width="600">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-four-agent-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 1: Example social network and sustainable adaptation diffusion problem.
</figcaption></figure>
</div>
<p>In the example, agent 2 has adopted rooftop solar. It has some adaptive fitness, which can be thought of as the financial gain from adopting a sustainable, adaptive behavior. We can directly create the social network using <code><a href="https://r.igraph.org/reference/make_graph.html" class="external-link">igraph::make_graph()</a></code> then set it as the model’s social network, along with setting the learning strategy to be contagion learning. The <code>adoption_rate</code> parameter specifies how likely another agent is to adopt the adaptive behavior when exposed to it. The <code>drop_rate</code> is how likely an agent doing the adaptive behavior is to stop doing it and revert to the non-adaptive behavior.</p>
<section class="level3"><h3 id="example-1-time-series-of-adaptation-diffusion">Example 1: Time series of adaptation diffusion<a class="anchor" aria-label="anchor" href="#example-1-time-series-of-adaptation-diffusion"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adoption_rate</span> <span class="op">=</span> <span class="fl">0.8</span></span>
<span> </span>
<span><span class="co"># Run model with </span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/make_graph.html" class="external-link">make_graph</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">1</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model_parameters.html">make_model_parameters</a></span><span class="op">(</span></span>
<span>  <span class="va">contagion_learning_strategy</span>, graph <span class="op">=</span> <span class="va">g</span>, adoption_rate <span class="op">=</span> <span class="fl">0.8</span>, drop_rate <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cabm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_abm.html">make_abm</a></span><span class="op">(</span><span class="va">mps</span><span class="op">)</span>; </span>
<span><span class="va">cabm</span><span class="op">$</span><span class="fu">get_agent</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="fu">set_behavior</span><span class="op">(</span><span class="st">"Adaptive"</span><span class="op">)</span>; </span>
<span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_trial.html">run_trial</a></span><span class="op">(</span><span class="va">cabm</span>, stop <span class="op">=</span> <span class="va">fixated</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_adoption.html">plot_adoption</a></span><span class="op">(</span><span class="va">trial</span>, tracked_behaviors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Legacy"</span>, <span class="st">"Adaptive"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="basic-diffusion-components_files/figure-html/unnamed-chunk-24-1.png" width="552"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Same, but now call the adaptive behavior "Baglowie" instead of "Adaptive".</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/make_graph.html" class="external-link">make_graph</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">1</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_model_parameters.html">make_model_parameters</a></span><span class="op">(</span></span>
<span>  <span class="va">contagion_learning_strategy</span>, graph <span class="op">=</span> <span class="va">g</span>, adoption_rate <span class="op">=</span> <span class="fl">0.8</span>, drop_rate <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cabm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_abm.html">make_abm</a></span><span class="op">(</span><span class="va">mps</span><span class="op">)</span></span>
<span><span class="va">cabm</span><span class="op">$</span><span class="fu">get_agent</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="fu">set_behavior</span><span class="op">(</span><span class="st">"Baglowie"</span><span class="op">)</span>; </span>
<span></span>
<span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_trial.html">run_trial</a></span><span class="op">(</span><span class="va">cabm</span>, stop <span class="op">=</span> <span class="va">fixated</span>, adaptive_behavior <span class="op">=</span> <span class="st">"Baglowie"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_adoption.html">plot_adoption</a></span><span class="op">(</span><span class="va">trial</span>, tracked_behaviors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Legacy"</span>, <span class="st">"Baglowie"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="basic-diffusion-components_files/figure-html/unnamed-chunk-25-1.png" width="552"></p>
</figure>
</div>
</div>
</div>
</section><section class="level3"><h3 id="example-comparison-of-learning-strategies-and-parameters">Example: comparison of learning strategies and parameters<a class="anchor" aria-label="anchor" href="#example-comparison-of-learning-strategies-and-parameters"></a>
</h3>
<p>Agent-based models in <code>socmod</code> are composed of sub-models of cognition and social behavior and social networks. One component of agent cognition is its <em>social learning strategy</em>. Three social learning strategies are included in <code>socmod</code>: success-biased, frequency-biased, and contagion learning strategies <a href="https://css4s.github.io/abm-notes/intro.html#social-learning-strategies" class="external-link">see ABM course notes for more details</a>.</p>
<p>Here we show how to compare the three learning strategies across different learning parameters. One parameter we systematically vary affects only success-biased learning, and the other we systematically vary affects only contagion learning. We will design computational experiments to understand their effects, and overall differences between the three learning strategies.</p>
<div class="cell" data-number-lines="true">
<div class="sourceCode cell-code" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load ggplot2 to avoid writing it during plotting below.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># Model generation function used in both computational experiments below.</span></span>
<span><span class="va">gen</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_parameter_row</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Extract adaptive_fitness to create agents.</span></span>
<span>  <span class="va">adaptive_fitness</span> <span class="op">&lt;-</span> <span class="va">model_parameter_row</span><span class="op">$</span><span class="va">adaptive_fitness</span></span>
<span>  </span>
<span>  <span class="va">agent_1</span> <span class="op">&lt;-</span> <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/Agent.html">Agent</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">1</span>, behavior <span class="op">=</span> <span class="st">"Legacy"</span>, </span>
<span>                               fitness <span class="op">=</span> <span class="fl">1.0</span>, name <span class="op">=</span> <span class="st">"a1"</span><span class="op">)</span></span>
<span>  <span class="va">agent_2</span> <span class="op">&lt;-</span> <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/Agent.html">Agent</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">2</span>, behavior <span class="op">=</span> <span class="st">"Adaptive"</span>, </span>
<span>                               fitness <span class="op">=</span> <span class="va">adaptive_fitness</span>, name <span class="op">=</span> <span class="st">"a2"</span><span class="op">)</span></span>
<span>  <span class="va">agent_3</span> <span class="op">&lt;-</span> <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/Agent.html">Agent</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">3</span>, behavior <span class="op">=</span> <span class="st">"Legacy"</span>, </span>
<span>                               fitness <span class="op">=</span> <span class="fl">1.0</span>, name <span class="op">=</span> <span class="st">"a3"</span><span class="op">)</span></span>
<span>  <span class="va">agent_4</span> <span class="op">&lt;-</span> <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/Agent.html">Agent</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fl">4</span>, behavior <span class="op">=</span> <span class="st">"Legacy"</span>, </span>
<span>                               fitness <span class="op">=</span> <span class="fl">1.0</span>, name <span class="op">=</span> <span class="st">"a4"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">agents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">agent_1</span>, <span class="va">agent_2</span>, <span class="va">agent_3</span>, <span class="va">agent_4</span><span class="op">)</span></span>
<span>  <span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://r.igraph.org/reference/make_graph.html" class="external-link">make_graph</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">1</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Extract other necessary model parameters.</span></span>
<span>  <span class="va">learning_strategy</span> <span class="op">&lt;-</span> <span class="va">model_parameter_row</span><span class="op">$</span><span class="va">learning_strategy</span></span>
<span>  <span class="va">drop_rate</span> <span class="op">&lt;-</span> <span class="va">model_parameter_row</span><span class="op">$</span><span class="va">drop_rate</span></span>
<span>  <span class="va">adoption_rate</span> <span class="op">&lt;-</span> <span class="va">model_parameter_row</span><span class="op">$</span><span class="va">adoption_rate</span></span>
<span>  </span>
<span>  <span class="co"># Make ModelParameters to encapsulate this model's parameters.</span></span>
<span>  <span class="va">model_parameters</span> <span class="op">&lt;-</span> <span class="fu">socmod</span><span class="fu">::</span><span class="fu"><a href="../reference/make_model_parameters.html">make_model_parameters</a></span><span class="op">(</span></span>
<span>    <span class="va">learning_strategy</span>, <span class="va">graph</span>, adaptive_fitness <span class="op">=</span> <span class="va">adaptive_fitness</span>, </span>
<span>    adoption_rate <span class="op">=</span> <span class="va">adoption_rate</span>, drop_rate <span class="op">=</span> <span class="va">drop_rate</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span></span>
<span>    <span class="fu">socmod</span><span class="fu">::</span><span class="fu"><a href="../reference/make_abm.html">make_abm</a></span><span class="op">(</span></span>
<span>      <span class="va">model_parameters</span>,</span>
<span>      agents <span class="op">=</span> <span class="va">agents</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<section class="level4"><h4 id="experiment-over-adaptive-fitness-values">Experiment over adaptive fitness values<a class="anchor" aria-label="anchor" href="#experiment-over-adaptive-fitness-values"></a>
</h4>
<div class="cell" data-number-lines="true">
<div class="sourceCode cell-code" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the adaptive fitness trials if there is not already a variable</span></span>
<span><span class="co"># name for it in the current environment. Change n_trials_per_param to</span></span>
<span><span class="co"># a small number like 2-20 for development purposes.</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"trials_adaptive_fitness"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span>all.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">trials_adaptive_fitness</span> <span class="op">&lt;-</span> <span class="fu">socmod</span><span class="fu">::</span><span class="fu"><a href="../reference/run_trials.html">run_trials</a></span><span class="op">(</span></span>
<span>    <span class="va">gen</span>, </span>
<span>    n_trials_per_param <span class="op">=</span> <span class="fl">100</span>,  <span class="co"># change to 2-20 for shorter runs</span></span>
<span>    stop <span class="op">=</span> <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/fixated.html">fixated</a></span>, </span>
<span>    syncfile <span class="op">=</span> <span class="st">"trials-adaptive_fitness.RData"</span>,</span>
<span>    <span class="co"># overwrite = TRUE,</span></span>
<span>    learning_strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/success_bias_learning_strategy.html">success_bias_learning_strategy</a></span>,</span>
<span>                          <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/frequency_bias_learning_strategy.html">frequency_bias_learning_strategy</a></span>,</span>
<span>                          <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/contagion_learning_strategy.html">contagion_learning_strategy</a></span><span class="op">)</span>,</span>
<span>    adaptive_fitness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">2.4</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>    adoption_rate <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>    drop_rate <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">trials_summary</span> <span class="op">&lt;-</span> <span class="fu">socmod</span><span class="fu">::</span><span class="fu"><a href="../reference/summarise_by_parameters.html">summarise_by_parameters</a></span><span class="op">(</span></span>
<span>  <span class="va">trials_adaptive_fitness</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"learning_strategy"</span>, <span class="st">"adaptive_fitness"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">trials_success_rate</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">trials_summary</span>, <span class="va">Measure</span> <span class="op">==</span> <span class="st">"success_rate"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Now plot…</p>
<div class="cell" data-number-lines="true">
<div class="sourceCode cell-code" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">trials_success_rate</span>, </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">adaptive_fitness</span>, y<span class="op">=</span><span class="va">Value</span>, </span>
<span>                  color<span class="op">=</span><span class="va">learning_strategy</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">2.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/scale_aaas.html" class="external-link">scale_color_aaas</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/scale_aaas.html" class="external-link">scale_fill_aaas</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Adaptive fitness"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Success rate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">trials_summary</span><span class="op">$</span><span class="va">adaptive_fitness</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Learning strategy"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Adoption rate = 0.6, drop rate = 0.2"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/resources/adaptive_fitness_experiment.png"</span>, <span class="va">p</span>, </span>
<span>       width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="adaptive_fitness_experiment.png"></p>
<figcaption>Example computational experiment testing effect of adaptive fitness on success rate across the three learning strategies.</figcaption></figure>
</div>
</section><section class="level4"><h4 id="experiment-over-adoption-rate-values">Experiment over adoption rate values<a class="anchor" aria-label="anchor" href="#experiment-over-adoption-rate-values"></a>
</h4>
<div class="cell" data-number-lines="true">
<div class="sourceCode cell-code" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"trials_adoption"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span>all.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">trials_adoption</span> <span class="op">&lt;-</span> <span class="fu">socmod</span><span class="fu">::</span><span class="fu"><a href="../reference/run_trials.html">run_trials</a></span><span class="op">(</span></span>
<span>    <span class="va">gen</span>,</span>
<span>    n_trials_per_param <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    stop <span class="op">=</span> <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/fixated.html">fixated</a></span>, </span>
<span>    syncfile <span class="op">=</span> <span class="st">"trials-adoption-rate.RData"</span>,</span>
<span>    overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    learning_strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/success_bias_learning_strategy.html">success_bias_learning_strategy</a></span>,</span>
<span>                          <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/frequency_bias_learning_strategy.html">frequency_bias_learning_strategy</a></span>,</span>
<span>                          <span class="fu">socmod</span><span class="fu">::</span><span class="va"><a href="../reference/contagion_learning_strategy.html">contagion_learning_strategy</a></span><span class="op">)</span>,</span>
<span>    adaptive_fitness <span class="op">=</span> <span class="fl">1.4</span>,</span>
<span>    adoption_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span><span class="op">)</span>,</span>
<span>    drop_rate <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">trials_summary</span> <span class="op">&lt;-</span> <span class="fu">socmod</span><span class="fu">::</span><span class="fu"><a href="../reference/summarise_by_parameters.html">summarise_by_parameters</a></span><span class="op">(</span></span>
<span>  <span class="va">trials_adoption</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"learning_strategy"</span>, <span class="st">"adoption_rate"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">trials_success_rate</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">trials_summary</span>, <span class="va">Measure</span> <span class="op">==</span> <span class="st">"success_rate"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="cell" data-number-lines="true">
<div class="sourceCode cell-code" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">trials_success_rate</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">adoption_rate</span>, y<span class="op">=</span><span class="va">Value</span>, color<span class="op">=</span><span class="va">learning_strategy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">2.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/scale_aaas.html" class="external-link">scale_color_aaas</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggsci</span><span class="fu">::</span><span class="fu"><a href="https://nanx.me/ggsci/reference/scale_aaas.html" class="external-link">scale_fill_aaas</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Adoption rate"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Success rate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">trials_summary</span><span class="op">$</span><span class="va">adoption_rate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Learning strategy"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Adaptive fitness = 1.4, drop rate = 0.2"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"vignettes/resources/adoption_rate_experiment.png"</span>, </span>
<span>       <span class="va">p</span>, width<span class="op">=</span><span class="fl">5</span>, height<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="adoption_rate_experiment.png"></p>
<figcaption>Example computational experiment testing effect of adoption rate on success rate across the three learning strategies.</figcaption></figure>
</div>
</section></section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matt Turner.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
